"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.helpers = exports.default = exports.commands = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("../logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _support = require("@appium/support");

var _baseDriver = require("@appium/base-driver");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

function toBool(s) {
  return _lodash.default.isString(s) ? s.toLowerCase() === 'true' : !!s;
}

commands.active = async function active() {
  return await this.uiautomator2.jwproxy.command('/element/active', 'GET');
};

commands.getAttribute = async function (attribute, elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/attribute/${attribute}`, 'GET', {});
};

commands.elementDisplayed = async function (elementId) {
  return toBool(await this.getAttribute('displayed', elementId));
};

commands.elementEnabled = async function (elementId) {
  return toBool(await this.getAttribute('enabled', elementId));
};

commands.elementSelected = async function (elementId) {
  return toBool(await this.getAttribute('selected', elementId));
};

commands.getName = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/name`, 'GET', {});
};

commands.getLocation = async function (elementId) {
  _logger.default.info(`calling get location: ${elementId}`);

  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/location`, 'GET', {});
};

commands.getSize = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/size`, 'GET', {});
};

commands.touchLongClick = async function (element, x, y, duration) {
  let params = {
    element,
    x,
    y,
    duration
  };
  return await this.uiautomator2.jwproxy.command(`/touch/longclick`, 'POST', {
    params
  });
};

commands.touchDown = async function (element, x, y) {
  let params = {
    element,
    x,
    y
  };
  return await this.uiautomator2.jwproxy.command(`/touch/down`, 'POST', {
    params
  });
};

commands.touchUp = async function (element, x, y) {
  let params = {
    element,
    x,
    y
  };
  return await this.uiautomator2.jwproxy.command(`/touch/up`, 'POST', {
    params
  });
};

commands.touchMove = async function (element, x, y) {
  let params = {
    element,
    x,
    y
  };
  return await this.uiautomator2.jwproxy.command(`/touch/move`, 'POST', {
    params
  });
};

helpers.doSetElementValue = async function (params) {
  return await this.uiautomator2.jwproxy.command(`/element/${params.elementId}/value`, 'POST', params);
};

commands.setValueImmediate = async function (keys, elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/value`, 'POST', {
    elementId,
    text: _lodash.default.isArray(keys) ? keys.join('') : keys,
    replace: false,
    unicodeKeyboard: this.opts.unicodeKeyboard
  });
};

commands.getText = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/text`, 'GET', {});
};

commands.click = async function (element) {
  return await this.uiautomator2.jwproxy.command(`/element/${element}/click`, 'POST', {
    element
  });
};

commands.getElementScreenshot = async function (element) {
  return await this.uiautomator2.jwproxy.command(`/element/${element}/screenshot`, 'GET', {});
};

commands.tap = async function (elementId = null, x = null, y = null, count = 1) {
  const areCoordinatesDefined = _support.util.hasValue(x) && _support.util.hasValue(y);

  if (!_support.util.hasValue(elementId) && !areCoordinatesDefined) {
    throw new Error(`Either element id to tap or both absolute coordinates should be defined`);
  }

  for (let i = 0; i < count; i++) {
    if (_support.util.hasValue(elementId) && !areCoordinatesDefined) {
      await this.uiautomator2.jwproxy.command(`/element/${elementId}/click`, 'POST');
    } else {
      await this.uiautomator2.jwproxy.command(`/appium/tap`, 'POST', {
        x,
        y,
        [_baseDriver.W3C_ELEMENT_KEY]: elementId
      });
    }
  }
};

commands.clear = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/clear`, 'POST', {
    elementId
  });
};

commands.getElementRect = async function (elementId) {
  if (this.isWebContext()) {
    _logger.default.debug(`Detected downstream chromedriver protocol: ${this.chromedriver.jwproxy.downstreamProtocol}`);

    if (this.chromedriver.jwproxy.downstreamProtocol === _baseDriver.PROTOCOLS.MJSONWP) {
      const {
        x,
        y
      } = await this.chromedriver.jwproxy.command(`/element/${elementId}/location`, 'GET');
      const {
        width,
        height
      } = await this.chromedriver.jwproxy.command(`/element/${elementId}/size`, 'GET');
      return {
        x,
        y,
        width,
        height
      };
    }

    return await this.chromedriver.jwproxy.command(`/element/${elementId}/rect`, 'GET');
  }

  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/rect`, 'GET');
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJ0b0Jvb2wiLCJzIiwiXyIsImlzU3RyaW5nIiwidG9Mb3dlckNhc2UiLCJhY3RpdmUiLCJ1aWF1dG9tYXRvcjIiLCJqd3Byb3h5IiwiY29tbWFuZCIsImdldEF0dHJpYnV0ZSIsImF0dHJpYnV0ZSIsImVsZW1lbnRJZCIsImVsZW1lbnREaXNwbGF5ZWQiLCJlbGVtZW50RW5hYmxlZCIsImVsZW1lbnRTZWxlY3RlZCIsImdldE5hbWUiLCJnZXRMb2NhdGlvbiIsImxvZyIsImluZm8iLCJnZXRTaXplIiwidG91Y2hMb25nQ2xpY2siLCJlbGVtZW50IiwieCIsInkiLCJkdXJhdGlvbiIsInBhcmFtcyIsInRvdWNoRG93biIsInRvdWNoVXAiLCJ0b3VjaE1vdmUiLCJkb1NldEVsZW1lbnRWYWx1ZSIsInNldFZhbHVlSW1tZWRpYXRlIiwia2V5cyIsInRleHQiLCJpc0FycmF5Iiwiam9pbiIsInJlcGxhY2UiLCJ1bmljb2RlS2V5Ym9hcmQiLCJvcHRzIiwiZ2V0VGV4dCIsImNsaWNrIiwiZ2V0RWxlbWVudFNjcmVlbnNob3QiLCJ0YXAiLCJjb3VudCIsImFyZUNvb3JkaW5hdGVzRGVmaW5lZCIsInV0aWwiLCJoYXNWYWx1ZSIsIkVycm9yIiwiaSIsIlczQ19FTEVNRU5UX0tFWSIsImNsZWFyIiwiZ2V0RWxlbWVudFJlY3QiLCJpc1dlYkNvbnRleHQiLCJkZWJ1ZyIsImNocm9tZWRyaXZlciIsImRvd25zdHJlYW1Qcm90b2NvbCIsIlBST1RPQ09MUyIsIk1KU09OV1AiLCJ3aWR0aCIsImhlaWdodCIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFB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N0QsVUFBZCxFQUEwQkYsUUFBMUIsRUFBb0NDLE9BQXBDO2VBRWVDLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgeyBQUk9UT0NPTFMsIFczQ19FTEVNRU5UX0tFWSB9IGZyb20gJ0BhcHBpdW0vYmFzZS1kcml2ZXInO1xuXG5sZXQgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmZ1bmN0aW9uIHRvQm9vbCAocykge1xuICByZXR1cm4gXy5pc1N0cmluZyhzKSA/IChzLnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJykgOiAhIXM7XG59XG5cbmNvbW1hbmRzLmFjdGl2ZSA9IGFzeW5jIGZ1bmN0aW9uIGFjdGl2ZSAoKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoJy9lbGVtZW50L2FjdGl2ZScsICdHRVQnKTtcbn07XG5cbmNvbW1hbmRzLmdldEF0dHJpYnV0ZSA9IGFzeW5jIGZ1bmN0aW9uIChhdHRyaWJ1dGUsIGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vYXR0cmlidXRlLyR7YXR0cmlidXRlfWAsICdHRVQnLCB7fSk7XG59O1xuXG5jb21tYW5kcy5lbGVtZW50RGlzcGxheWVkID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gdG9Cb29sKGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRlKCdkaXNwbGF5ZWQnLCBlbGVtZW50SWQpKTtcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRFbmFibGVkID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gdG9Cb29sKGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRlKCdlbmFibGVkJywgZWxlbWVudElkKSk7XG59O1xuXG5jb21tYW5kcy5lbGVtZW50U2VsZWN0ZWQgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiB0b0Jvb2woYXdhaXQgdGhpcy5nZXRBdHRyaWJ1dGUoJ3NlbGVjdGVkJywgZWxlbWVudElkKSk7XG59O1xuXG5jb21tYW5kcy5nZXROYW1lID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vbmFtZWAsICdHRVQnLCB7fSk7XG59O1xuXG5jb21tYW5kcy5nZXRMb2NhdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgbG9nLmluZm8oYGNhbGxpbmcgZ2V0IGxvY2F0aW9uOiAke2VsZW1lbnRJZH1gKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L2xvY2F0aW9uYCwgJ0dFVCcsIHt9KTtcbn07XG5cbmNvbW1hbmRzLmdldFNpemUgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9zaXplYCwgJ0dFVCcsIHt9KTtcbn07XG5cbmNvbW1hbmRzLnRvdWNoTG9uZ0NsaWNrID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQsIHgsIHksIGR1cmF0aW9uKSB7XG4gIGxldCBwYXJhbXMgPSB7ZWxlbWVudCwgeCwgeSwgZHVyYXRpb259O1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvdG91Y2gvbG9uZ2NsaWNrYCwgJ1BPU1QnLCB7cGFyYW1zfSk7XG59O1xuXG5jb21tYW5kcy50b3VjaERvd24gPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudCwgeCwgeSkge1xuICBsZXQgcGFyYW1zID0ge2VsZW1lbnQsIHgsIHl9O1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvdG91Y2gvZG93bmAsICdQT1NUJywge3BhcmFtc30pO1xufTtcblxuY29tbWFuZHMudG91Y2hVcCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50LCB4LCB5KSB7XG4gIGxldCBwYXJhbXMgPSB7ZWxlbWVudCwgeCwgeX07XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC90b3VjaC91cGAsICdQT1NUJywge3BhcmFtc30pO1xufTtcblxuY29tbWFuZHMudG91Y2hNb3ZlID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQsIHgsIHkpIHtcbiAgbGV0IHBhcmFtcyA9IHtlbGVtZW50LCB4LCB5fTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL3RvdWNoL21vdmVgLCAnUE9TVCcsIHtwYXJhbXN9KTtcbn07XG5cbmhlbHBlcnMuZG9TZXRFbGVtZW50VmFsdWUgPSBhc3luYyBmdW5jdGlvbiAocGFyYW1zKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7cGFyYW1zLmVsZW1lbnRJZH0vdmFsdWVgLCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5jb21tYW5kcy5zZXRWYWx1ZUltbWVkaWF0ZSA9IGFzeW5jIGZ1bmN0aW9uIChrZXlzLCBlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L3ZhbHVlYCwgJ1BPU1QnLCB7XG4gICAgZWxlbWVudElkLFxuICAgIHRleHQ6IF8uaXNBcnJheShrZXlzKSA/IGtleXMuam9pbignJykgOiBrZXlzLFxuICAgIHJlcGxhY2U6IGZhbHNlLFxuICAgIHVuaWNvZGVLZXlib2FyZDogdGhpcy5vcHRzLnVuaWNvZGVLZXlib2FyZCxcbiAgfSk7XG59O1xuXG5jb21tYW5kcy5nZXRUZXh0ID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vdGV4dGAsICdHRVQnLCB7fSk7XG59O1xuXG5jb21tYW5kcy5jbGljayA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudH0vY2xpY2tgLCAnUE9TVCcsIHtlbGVtZW50fSk7XG59O1xuXG5jb21tYW5kcy5nZXRFbGVtZW50U2NyZWVuc2hvdCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudH0vc2NyZWVuc2hvdGAsICdHRVQnLCB7fSk7XG59O1xuXG5jb21tYW5kcy50YXAgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkID0gbnVsbCwgeCA9IG51bGwsIHkgPSBudWxsLCBjb3VudCA9IDEpIHtcbiAgY29uc3QgYXJlQ29vcmRpbmF0ZXNEZWZpbmVkID0gdXRpbC5oYXNWYWx1ZSh4KSAmJiB1dGlsLmhhc1ZhbHVlKHkpO1xuICBpZiAoIXV0aWwuaGFzVmFsdWUoZWxlbWVudElkKSAmJiAhYXJlQ29vcmRpbmF0ZXNEZWZpbmVkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBFaXRoZXIgZWxlbWVudCBpZCB0byB0YXAgb3IgYm90aCBhYnNvbHV0ZSBjb29yZGluYXRlcyBzaG91bGQgYmUgZGVmaW5lZGApO1xuICB9XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgaWYgKHV0aWwuaGFzVmFsdWUoZWxlbWVudElkKSAmJiAhYXJlQ29vcmRpbmF0ZXNEZWZpbmVkKSB7XG4gICAgICAvLyB3ZSBhcmUgZWl0aGVyIHRhcHBpbmcgb24gdGhlIGRlZmF1bHQgbG9jYXRpb24gb2YgdGhlIGVsZW1lbnRcbiAgICAgIC8vIG9yIGFuIG9mZnNldCBmcm9tIHRoZSB0b3AgbGVmdCBjb3JuZXJcbiAgICAgIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L2NsaWNrYCwgJ1BPU1QnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvYXBwaXVtL3RhcGAsICdQT1NUJywge1xuICAgICAgICB4LCB5LFxuICAgICAgICBbVzNDX0VMRU1FTlRfS0VZXTogZWxlbWVudElkLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG59O1xuXG5jb21tYW5kcy5jbGVhciA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L2NsZWFyYCwgJ1BPU1QnLCB7ZWxlbWVudElkfSk7XG59O1xuXG5jb21tYW5kcy5nZXRFbGVtZW50UmVjdCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICBsb2cuZGVidWcoYERldGVjdGVkIGRvd25zdHJlYW0gY2hyb21lZHJpdmVyIHByb3RvY29sOiAke3RoaXMuY2hyb21lZHJpdmVyLmp3cHJveHkuZG93bnN0cmVhbVByb3RvY29sfWApO1xuICAgIGlmICh0aGlzLmNocm9tZWRyaXZlci5qd3Byb3h5LmRvd25zdHJlYW1Qcm90b2NvbCA9PT0gUFJPVE9DT0xTLk1KU09OV1ApIHtcbiAgICAgIGNvbnN0IHt4LCB5fSA9IGF3YWl0IHRoaXMuY2hyb21lZHJpdmVyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L2xvY2F0aW9uYCwgJ0dFVCcpO1xuICAgICAgY29uc3Qge3dpZHRoLCBoZWlnaHR9ID0gYXdhaXQgdGhpcy5jaHJvbWVkcml2ZXIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vc2l6ZWAsICdHRVQnKTtcbiAgICAgIHJldHVybiB7eCwgeSwgd2lkdGgsIGhlaWdodH07XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNocm9tZWRyaXZlci5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9yZWN0YCwgJ0dFVCcpO1xuICB9XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9yZWN0YCwgJ0dFVCcpO1xufTtcblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcywgaGVscGVycyk7XG5leHBvcnQgeyBjb21tYW5kcywgaGVscGVycyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2VsZW1lbnQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
